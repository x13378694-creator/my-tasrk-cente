<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æŒ‡æŒ¥éƒ¨ v8.2 | å®Œç¾å¸ƒå±€ç‰ˆ</title>
    <style>
        /* --- 0. æ ¸å¿ƒå˜é‡ (Neo-Brutalism) --- */
        :root {
            --bg: #f2f2f2;         
            --card-bg: #ffffff;    
            --border: #000000;     
            --border-width: 3px;   
            --shadow: 5px 5px 0px 0px #000000; 
            --accent: #000000;     
            --text: #000000;
        }

        * { box-sizing: border-box; }
        
        body { 
            background-color: var(--bg); 
            color: var(--text); 
            font-family: 'Courier New', Courier, monospace, sans-serif;
            margin: 0; 
            height: 100vh; 
            display: flex; 
            flex-direction: column; 
            overflow: hidden;
        }

        /* --- é¡¶æ  --- */
        nav {
            padding: 10px 20px;
            background: var(--card-bg);
            border-bottom: var(--border-width) solid var(--border);
            display: flex; justify-content: space-between; align-items: center;
            flex-shrink: 0;
        }
        
        h1 {
            margin: 0; font-size: 18px; font-weight: 900; text-transform: uppercase;
            background: #000; color: #fff; padding: 5px 10px;
        }

        /* --- ä¸»å¸ƒå±€ (Grid ä¿®æ­£ç‰ˆ) --- */
        main {
            flex: 1;
            padding: 20px;
            display: grid;
            /* å·¦è¾¹ 300pxï¼Œå³è¾¹è‡ªé€‚åº” */
            grid-template-columns: 300px 1fr;
            /* åªæœ‰ä¸€è¡Œï¼Œå·¦ä¾§å æ»¡ï¼›å³ä¾§å†…éƒ¨å†åˆ†å±‚ */
            grid-template-rows: 100%;
            gap: 20px;
            overflow: hidden;
        }

        /* --- å·¦ä¾§ä¾§è¾¹æ  --- */
        .sidebar {
            background: var(--card-bg);
            border: var(--border-width) solid var(--border);
            box-shadow: var(--shadow);
            display: flex; flex-direction: column;
            overflow: hidden;
            height: 100%; /* å¼ºåˆ¶å…¨é«˜ */
        }

        /* --- å³ä¾§é¢æ¿å®¹å™¨ (Flex çºµå‘å¸ƒå±€) --- */
        .right-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
            height: 100%;
            overflow: hidden;
        }

        /* --- æ ¸å¿ƒå·¥ä½œåŒº (è‡ªåŠ¨æ’‘æ»¡å‰©ä½™ç©ºé—´) --- */
        .workspace {
            flex: 1; /* å…³é”®ï¼šå æ®æ‰€æœ‰å‰©ä½™é«˜åº¦ */
            display: grid;
            grid-template-columns: 1fr 1fr; /* å·¦å³ä¸¤æ  */
            grid-template-rows: auto 1fr;   /* æ ‡é¢˜æ é«˜åº¦è‡ªé€‚åº”ï¼Œå†…å®¹åŒºæ’‘æ»¡ */
            gap: 20px;
            overflow: hidden;
            min-height: 0; /* é˜²æ­¢æº¢å‡º */
        }

        /* --- åº•éƒ¨æ‰‹å†ŒåŒº (å›ºå®šé«˜åº¦ï¼Œå†…å®¹æ»šåŠ¨) --- */
        .manual-box {
            height: 180px; /* å›ºå®šé«˜åº¦ï¼Œä¸æŠ¢å ç©ºé—´ */
            flex-shrink: 0;
            background: #fff;
            border: var(--border-width) solid var(--border);
            box-shadow: var(--shadow);
            display: flex; flex-direction: column;
            overflow: hidden;
        }

        /* --- ç»„ä»¶æ ·å¼ --- */
        .list-header {
            padding: 15px; border-bottom: 2px solid #000; background: #eee; font-weight: bold;
            display: flex; justify-content: space-between; align-items: center;
        }
        
        .task-item {
            padding: 12px 15px; border-bottom: 2px solid #000; cursor: pointer;
            display: flex; justify-content: space-between; align-items: center;
        }
        .task-item:hover { background: #f9f9f9; }
        .task-item.active { background: #000; color: #fff; }
        .task-item.active .del-btn { border-color: #fff; color: #fff; }

        .del-btn {
            font-size: 10px; padding: 2px 6px; border: 1px solid #000; margin-left: 5px;
            background: transparent; color: #000;
        }
        .del-btn:hover { background: red; color: white; border-color: red; }

        /* ä»»åŠ¡æ ‡é¢˜æ  */
        .task-header-box {
            grid-column: 1 / -1;
            padding: 15px; background: #fff;
            border: var(--border-width) solid var(--border);
            box-shadow: var(--shadow);
            display: flex; justify-content: space-between; align-items: center;
        }
        .title-input { font-size: 20px; font-weight: 900; border: none; outline: none; width: 70%; font-family: inherit; }

        /* å­ä»»åŠ¡ç›’å­ */
        .subtasks-box {
            border: var(--border-width) solid var(--border);
            box-shadow: var(--shadow);
            background: white;
            padding: 15px;
            overflow: hidden; display: flex; flex-direction: column;
        }

        /* SOP ç›’å­ */
        .sop-box {
            border: var(--border-width) solid var(--border);
            box-shadow: var(--shadow);
            background: white;
            display: flex; flex-direction: column;
            overflow: hidden;
        }

        .box-title { 
            font-weight: bold; border-bottom: 2px solid #000; padding-bottom: 5px; margin-bottom: 10px; 
            display: flex; justify-content: space-between;
        }

        .check-row {
            display: flex; align-items: center; gap: 10px; padding: 8px; border: 2px solid #000;
            margin-bottom: 8px; cursor: pointer;
        }
        .check-row.done { background: #ccc; text-decoration: line-through; opacity: 0.6; }
        .check-box { width: 16px; height: 16px; border: 2px solid #000; background: #fff; flex-shrink: 0; }
        .check-row.done .check-box { background: #000; }

        /* è¾“å…¥æ¡†ä¸æŒ‰é’® */
        button {
            background: #fff; border: 2px solid #000; padding: 5px 15px; font-weight: 900; 
            box-shadow: 2px 2px 0 0 #000; cursor: pointer;
        }
        button:active { transform: translate(1px, 1px); box-shadow: 1px 1px 0 0 #000; }
        button.primary { background: #000; color: #fff; }
        
        .input-brutal { border: 2px solid #000; padding: 8px; outline: none; flex: 1; font-family: inherit; }

        /* æ‰‹å†Œå†…å®¹ */
        .manual-tabs { 
            display: flex; border-bottom: 2px solid #000; background: #eee;
        }
        .manual-tab {
            padding: 8px 15px; cursor: pointer; font-weight: bold; font-size: 12px; border-right: 2px solid #000;
        }
        .manual-tab.active { background: #fff; border-bottom: 2px solid #fff; margin-bottom: -2px; }
        
        .manual-content { padding: 15px; overflow-y: auto; font-size: 12px; line-height: 1.8; flex: 1; }

        /* æ‰‹æœºé€‚é… */
        @media (max-width: 768px) {
            main { grid-template-columns: 1fr; padding: 10px; gap: 10px; display: flex; flex-direction: column; }
            .sidebar { height: 200px; flex-shrink: 0; }
            .right-panel { flex: 1; overflow-y: auto; }
            .workspace { display: flex; flex-direction: column; height: auto; flex: none; }
            .subtasks-box, .sop-box { height: 300px; flex-shrink: 0; }
            .manual-box { height: auto; flex-shrink: 0; }
        }
    </style>
</head>
<body>

    <nav>
        <h1>TASK_HQ_V8.2</h1>
        <div style="font-size:12px; font-weight:bold;">å®Œç¾å¸ƒå±€ç‰ˆ</div>
    </nav>

    <main>
        <aside class="sidebar">
            <div class="list-header">
                MISSION LIST
                <button onclick="addTask()">ï¼‹ æ–°å»º</button>
            </div>
            <div id="list-container" style="flex:1; overflow-y:auto;"></div>
        </aside>

        <div class="right-panel">
            
            <div class="workspace">
                <div class="task-header-box">
                    <input type="text" id="task-title" class="title-input" onchange="updateTask('title', this.value)">
                    <div style="display:flex; align-items:center; gap:10px;">
                        <span id="progress-text" style="font-size:24px; font-weight:900; opacity:0.3;">0%</span>
                    </div>
                </div>

                <div class="subtasks-box">
                    <div class="box-title">æ‰§è¡Œæ­¥éª¤ (Checklist)</div>
                    <div id="subtask-list" style="flex:1; overflow-y:auto; padding-right:5px;"></div>
                    <div style="display:flex; gap:10px; margin-top:10px;">
                        <input type="text" id="new-sub-input" class="input-brutal" placeholder="ä¸‹ä¸€æ­¥...">
                        <button class="primary" onclick="addSubTask()">æ·»åŠ </button>
                    </div>
                </div>

                <div class="sop-box">
                    <div class="box-title">
                        SOP ä½œæˆ˜æ‰‹å†Œ
                        <span onclick="toggleSopEdit()" style="cursor:pointer; font-size:10px; text-decoration:underline;">[ç¼–è¾‘/ä¿å­˜]</span>
                    </div>
                    <div id="sop-view" style="flex:1; overflow-y:auto; font-size:13px; white-space:pre-wrap; padding-right:5px;"></div>
                    <textarea id="sop-edit" style="flex:1; padding:10px; resize:none; border:none; outline:none; display:none; font-family:monospace;"></textarea>
                </div>
            </div>

            <div class="manual-box">
                <div class="manual-tabs">
                    <div class="manual-tab active" onclick="switchManual('guide')" id="tab-guide">ğŸ“˜ ç³»ç»Ÿä½¿ç”¨è¯´æ˜ä¹¦</div>
                    <div class="manual-tab" onclick="switchManual('sync')" id="tab-sync">ğŸ”„ æ•°æ®æ¬è¿(åŒæ­¥)</div>
                </div>

                <div id="content-guide" class="manual-content">
                    <strong>ä¸€ã€ ç”µè„‘ç«¯ä¸æ‰‹æœºç«¯ä½¿ç”¨</strong><br>
                    1. <strong>å›ºå®šåˆ°æ¡Œé¢</strong>ï¼šåœ¨æµè§ˆå™¨è®¾ç½®ä¸­ç‚¹å‡»â€œå®‰è£…åº”ç”¨â€æˆ–â€œæ·»åŠ åˆ°ä¸»å±å¹•â€ï¼Œå³å¯åƒ App ä¸€æ ·å…¨å±è¿è¡Œã€‚<br>
                    2. <strong>å¸ƒå±€é€‚åº”</strong>ï¼šç”µè„‘ç«¯å·¦å³åˆ†æ ï¼Œæ‰‹æœºç«¯ä¸Šä¸‹æ’åˆ—ï¼Œè‡ªåŠ¨é€‚åº”å±å¹•ã€‚<br>
                    <br>
                    <strong>äºŒã€ æŒ‰é’®åŠŸèƒ½è¯¦è§£</strong><br>
                    1. <strong>[ï¼‹æ–°å»º]</strong>ï¼šä½äºå·¦ä¾§åˆ—è¡¨é¡¶éƒ¨ã€‚ç‚¹å‡»åˆ›å»ºä¸€ä¸ªç©ºç™½ä»»åŠ¡ã€‚<br>
                    2. <strong>[åˆ ]</strong>ï¼šä½äºä»»åŠ¡åç§°å³ä¾§ã€‚ç‚¹å‡»ç›´æ¥åˆ é™¤è¯¥ä»»åŠ¡ï¼ˆä¸å¯æ¢å¤ï¼Œè¯·å°å¿ƒï¼‰ã€‚<br>
                    3. <strong>[æ·»åŠ ]</strong>ï¼šä½äºä¸­é—´ä¸‹æ–¹ã€‚è¾“å…¥æ–‡å­—åç‚¹å‡»ï¼Œå¢åŠ ä¸€æ¡æ‰§è¡Œæ­¥éª¤ã€‚<br>
                    4. <strong>[ç¼–è¾‘/ä¿å­˜]</strong>ï¼šä½äº SOP åŒºåŸŸå³ä¸Šè§’ã€‚ç‚¹å‡»åˆ‡æ¢ç¼–è¾‘æ¨¡å¼ï¼Œç²˜è´´æˆ–ä¿®æ”¹æ”»ç•¥ã€‚<br>
                    <br>
                    <strong>ä¸‰ã€ å¸¸è§é—®é¢˜</strong><br>
                    - <strong>æ•°æ®å»å“ªäº†ï¼Ÿ</strong> æ‰€æœ‰æ•°æ®å®æ—¶ä¿å­˜åœ¨ä½ å½“å‰çš„æµè§ˆå™¨ä¸­ã€‚åªè¦ä¸æ¸…é™¤æµè§ˆå™¨ç¼“å­˜ï¼Œæ•°æ®æ°¸ä¹…æœ‰æ•ˆã€‚<br>
                    - <strong>å¦‚ä½•åŒæ­¥ï¼Ÿ</strong> ç‚¹å‡»ä¸Šæ–¹çš„â€œæ•°æ®æ¬è¿(åŒæ­¥)â€æ ‡ç­¾ï¼Œä½¿ç”¨å¤åˆ¶ç²˜è´´æ³•ä¼ è¾“æ•°æ®ã€‚
                </div>

                <div id="content-sync" class="manual-content" style="display:none; gap:10px;">
                    <p style="margin:0 0 5px 0;">å°†ä¸‹æ–¹ä»£ç å¤åˆ¶å‘ç»™æ‰‹æœºï¼Œæˆ–å°†æ‰‹æœºä»£ç ç²˜è´´è‡³æ­¤ç‚¹å‡»å¯¼å…¥ã€‚</p>
                    <textarea id="data-area" class="input-brutal" style="height:50px; font-size:10px;"></textarea>
                    <div style="display:flex; gap:10px; margin-top:5px;">
                        <button onclick="copyData()">1. å¤åˆ¶å¯¼å‡º</button>
                        <button class="primary" onclick="importData()">2. ç²˜è´´å¯¼å…¥</button>
                    </div>
                </div>
            </div>

        </div>
    </main>

    <script>
        // --- ä½ çš„åŸå§‹æ•°æ® ---
        const HARD_DATA = [{"id":1769856578154,"title":"dankoeçš„åœ¨ä¸€å¤©å†…å½»åº•æ”¹å˜äººç”Ÿåˆ°åº•æœ‰å¤šå¼ºå¤§","subtasks":[],"reminderTime":"","sop":""},{"id":1769855581999,"title":"åšä¸€ä¸ªæ¯æ—¥æé†’dankoeå†™çš„é—®é¢˜æé†’","subtasks":[],"reminderTime":"","sop":""},{"id":1769850813071,"title":"æ¢æ¨ç‰¹å·ï¼Œå†™ä¸€ç¯‡å…³äºç…œå­æ˜¾åŒ–æ–‡ç« ","subtasks":[],"reminderTime":"","sop":""},{"id":1769786819936,"title":"å†™ä¸€ç¯‡å…¬ä¼—å·ç§è‰","subtasks":[{"text":"é€‰é¢˜","done":false},{"text":"é€‰é¢˜ï¼šä¸ºä»€ä¹ˆè¯´ï¼Œaiæ—¶ä»£æˆ‘ä»¬çš„ä¼˜åŠ¿æ›´å¤šäº†ï¼Ÿ","done":false}],"reminderTime":"08:00","sop":""},{"id":1769774974790,"title":"ç»ˆç‚¹ç³»ç»Ÿç½‘é¡µåˆ¶ä½œ","subtasks":[{"text":"å»ºç«‹å¤§çº²","done":true},{"text":"åšå®šè‡ªå·±çš„æƒ³æ³•...","done":true},{"text":"åˆ†äº«ç»™æœ‹å‹...","done":true},{"text":"å­¦ä¼šå¦‚ä½•åœ¨githubé‡Œé¢åšç½‘å€","done":true},{"text":"åŠ å…¥ä½¿ç”¨æ‰‹å†Œ","done":true}],"reminderTime":"08:09","sop":"# ğŸ–ï¸ å…¨èƒ½å¼€å‘è€…åè®® (v3.0)\n\n## é˜¶æ®µä¸€ï¼šå»ºç«‹å¤§çº²\n- ç¡¬æ€§è¦æ±‚ï¼šä¸¥ç¦ç›´æ¥è®© AI å¼€å·¥ã€‚\n..."}];

        let tasks = [];
        let currentId = null;

        window.onload = function() {
            const local = localStorage.getItem('cmd_v82_data');
            if(local && local.length > 20) {
                try { tasks = JSON.parse(local); } catch(e) { tasks = HARD_DATA; }
            } else {
                tasks = HARD_DATA;
            }
            if(tasks.length === 0) addTask(); 
            else selectTask(tasks[0].id);
        };

        function saveData() {
            localStorage.setItem('cmd_v82_data', JSON.stringify(tasks));
            document.getElementById('data-area').value = JSON.stringify(tasks);
        }

        function addTask() {
            const id = Date.now();
            tasks.unshift({ id: id, title: "æ–°ä»»åŠ¡ " + new Date().toLocaleTimeString().slice(0,5), subtasks: [], sop: "", reminderTime: "" });
            selectTask(id);
        }

        function deleteTask(e, id) {
            e.stopPropagation();
            if(confirm("ç¡®è®¤åˆ é™¤æ­¤ä»»åŠ¡ï¼Ÿ")) {
                tasks = tasks.filter(t => t.id !== id);
                if(tasks.length === 0) addTask();
                else selectTask(tasks[0].id);
            }
        }

        function selectTask(id) {
            currentId = id;
            renderList();
            renderDetail();
        }

        function renderList() {
            const container = document.getElementById('list-container');
            container.innerHTML = tasks.map(t => {
                const total = t.subtasks ? t.subtasks.length : 0;
                const done = t.subtasks ? t.subtasks.filter(s => s.done).length : 0;
                const percent = total === 0 ? 0 : Math.round((done / total) * 100);
                
                return `
                <div class="task-item ${t.id === currentId ? 'active' : ''}" onclick="selectTask(${t.id})">
                    <div style="flex:1; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; padding-right:10px;">
                        ${t.title}
                    </div>
                    <div style="font-size:12px; font-weight:bold;">${percent}%</div>
                    <button class="del-btn" onclick="deleteTask(event, ${t.id})">åˆ </button>
                </div>`;
            }).join('');
        }

        function renderDetail() {
            const t = tasks.find(x => x.id === currentId);
            if(!t) return;

            document.getElementById('task-title').value = t.title;
            
            // SOP
            document.getElementById('sop-view').innerText = t.sop || "ï¼ˆç‚¹å‡»å³ä¸Šè§’ [ç¼–è¾‘/ä¿å­˜] æ·»åŠ å†…å®¹ï¼‰";
            document.getElementById('sop-edit').value = t.sop || "";

            // å­ä»»åŠ¡
            const subContainer = document.getElementById('subtask-list');
            subContainer.innerHTML = (t.subtasks || []).map((s, idx) => `
                <div class="check-row ${s.done ? 'done' : ''}" onclick="toggleSub(${idx})">
                    <div class="check-box">${s.done ? 'âœ“' : ''}</div>
                    <span style="flex:1;">${s.text}</span>
                </div>
            `).join('');

            // è¿›åº¦
            const total = t.subtasks ? t.subtasks.length : 0;
            const done = t.subtasks ? t.subtasks.filter(s => s.done).length : 0;
            const percent = total === 0 ? 0 : Math.round((done / total) * 100);
            document.getElementById('progress-text').innerText = percent + "%";
        }

        function updateTask(field, value) {
            const t = tasks.find(x => x.id === currentId);
            if(field === 'title') { t.title = value; renderList(); }
            saveData();
        }

        function addSubTask() {
            const input = document.getElementById('new-sub-input');
            if(!input.value) return;
            const t = tasks.find(x => x.id === currentId);
            if(!t.subtasks) t.subtasks = [];
            t.subtasks.push({ text: input.value, done: false });
            input.value = "";
            saveData(); renderDetail(); renderList();
        }

        function toggleSub(idx) {
            const t = tasks.find(x => x.id === currentId);
            t.subtasks[idx].done = !t.subtasks[idx].done;
            saveData(); renderDetail(); renderList();
        }

        function toggleSopEdit() {
            const view = document.getElementById('sop-view');
            const edit = document.getElementById('sop-edit');
            const t = tasks.find(x => x.id === currentId);
            
            if(edit.style.display === 'block') {
                t.sop = edit.value;
                view.innerText = t.sop;
                edit.style.display = 'none'; view.style.display = 'block';
                saveData();
            } else {
                edit.style.display = 'block'; view.style.display = 'none';
                edit.focus();
            }
        }

        function switchManual(type) {
            document.getElementById('content-guide').style.display = type === 'guide' ? 'block' : 'none';
            document.getElementById('content-sync').style.display = type === 'sync' ? 'flex' : 'none';
            document.getElementById('tab-guide').className = type === 'guide' ? 'manual-tab active' : 'manual-tab';
            document.getElementById('tab-sync').className = type === 'sync' ? 'manual-tab active' : 'manual-tab';
            if(type === 'sync') document.getElementById('data-area').value = JSON.stringify(tasks);
        }

        function copyData() {
            document.getElementById('data-area').select();
            document.execCommand('copy');
            alert("å·²å¤åˆ¶ï¼");
        }

        function importData() {
            try {
                const val = document.getElementById('data-area').value;
                if(!val) return;
                const newData = JSON.parse(val);
                if(confirm("å¯¼å…¥å°†è¦†ç›–å½“å‰æ•°æ®ï¼Œç¡®å®šå—ï¼Ÿ")) {
                    tasks = newData;
                    saveData(); renderList(); selectTask(tasks[0].id);
                    alert("å¯¼å…¥æˆåŠŸï¼");
                }
            } catch(e) { alert("æ•°æ®æ ¼å¼é”™è¯¯"); }
        }
    </script>
</body>
</html>
