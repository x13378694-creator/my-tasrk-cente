<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æŒ‡æŒ¥éƒ¨ v8.0 | æ–°ç²—é‡ä¸»ä¹‰</title>
    <style>
        /* --- 0. æ–°ç²—é‡ä¸»ä¹‰æ ¸å¿ƒå˜é‡ --- */
        :root {
            --bg: #f2f2f2;         /* æµ…ç°èƒŒæ™¯ï¼Œçªå‡ºå¡ç‰‡ */
            --card-bg: #ffffff;    /* çº¯ç™½å¡ç‰‡ */
            --border: #000000;     /* çº¯é»‘è¾¹æ¡† */
            --border-width: 3px;   /* ç²—è¾¹æ¡† */
            --shadow: 5px 5px 0px 0px #000000; /* ç¡¬é˜´å½± */
            --accent: #000000;     /* å¼ºè°ƒè‰²ä¹Ÿæ˜¯é»‘è‰² */
            --text: #000000;
        }

        * { box-sizing: border-box; }
        
        body { 
            background-color: var(--bg); 
            color: var(--text); 
            font-family: 'Courier New', Courier, monospace, sans-serif; /* æ‰“å­—æœºå­—ä½“æ›´ç¬¦åˆç²—é‡é£æ ¼ */
            margin: 0; 
            height: 100vh; 
            display: flex; 
            flex-direction: column; 
            overflow: hidden;
        }

        /* --- é¡¶æ  --- */
        nav {
            padding: 15px 20px;
            background: var(--card-bg);
            border-bottom: var(--border-width) solid var(--border);
            display: flex; 
            justify-content: space-between; 
            align-items: center;
        }
        
        h1 {
            margin: 0;
            font-size: 20px;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: -1px;
            background: #000;
            color: #fff;
            padding: 5px 10px;
        }

        /* --- ä¸»å¸ƒå±€ (Bento Grid) --- */
        main {
            flex: 1;
            padding: 20px;
            display: grid;
            grid-template-columns: 300px 1fr; /* å·¦ä¾§åˆ—è¡¨å›ºå®šï¼Œå³ä¾§è¯¦æƒ…è‡ªé€‚åº” */
            grid-template-rows: 2fr 1fr;      /* ä¸Šéƒ¨åˆ†æ˜¯æ ¸å¿ƒæ“ä½œï¼Œä¸‹éƒ¨åˆ†æ˜¯æ‰‹å†Œ/æ¬è¿ */
            gap: 20px;
            overflow: hidden;
        }

        /* --- é€šç”¨å¡ç‰‡æ ·å¼ (Box) --- */
        .box {
            background: var(--card-bg);
            border: var(--border-width) solid var(--border);
            box-shadow: var(--shadow);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transition: transform 0.1s;
        }
        .box:active {
            transform: translate(2px, 2px);
            box-shadow: 3px 3px 0px 0px #000;
        }

        /* --- å·¦ä¾§ï¼šä»»åŠ¡åˆ—è¡¨ --- */
        .sidebar {
            grid-row: 1 / -1; /* å æ»¡å·¦ä¾§å…¨é«˜ */
        }
        .list-header {
            padding: 15px;
            border-bottom: var(--border-width) solid var(--border);
            background: #eee;
            font-weight: bold;
            display: flex; justify-content: space-between; align-items: center;
        }
        
        .task-item {
            padding: 15px;
            border-bottom: 2px solid #000;
            cursor: pointer;
            display: flex; justify-content: space-between; align-items: center;
        }
        .task-item:hover { background: #f9f9f9; }
        .task-item.active { 
            background: #000; 
            color: #fff; 
        }
        .task-item.active .del-btn { color: #fff; border-color: #fff; }

        .del-btn {
            font-size: 12px;
            padding: 2px 6px;
            border: 2px solid #000;
            font-weight: bold;
            margin-left: 10px;
        }
        .del-btn:hover { background: red; color: white; border-color: red; }

        /* --- å³ä¾§ä¸Šéƒ¨ï¼šè¯¦æƒ…ä¸SOP --- */
        .workspace {
            display: grid;
            grid-template-columns: 1fr 1fr; /* å·¦å³åˆ†æ ï¼šå·¦è¾¹å­ä»»åŠ¡ï¼Œå³è¾¹SOP */
            gap: 20px;
            overflow: hidden;
        }

        /* ä»»åŠ¡æ ‡é¢˜æ  */
        .task-header-box {
            grid-column: 1 / -1;
            padding: 15px;
            border-bottom: var(--border-width) solid var(--border);
            display: flex; justify-content: space-between; align-items: center;
            background: #fff;
        }
        
        .title-input {
            font-size: 24px; font-weight: 900; border: none; outline: none; width: 80%;
            font-family: inherit;
        }
        
        /* å­ä»»åŠ¡åŒºåŸŸ */
        .subtasks-box {
            border: var(--border-width) solid var(--border);
            box-shadow: var(--shadow);
            background: white;
            padding: 15px;
            overflow-y: auto;
            display: flex; flex-direction: column; gap: 10px;
        }

        .check-row {
            display: flex; align-items: center; gap: 10px;
            padding: 10px; border: 2px solid #000;
            cursor: pointer;
            font-weight: bold;
        }
        .check-row.done {
            background: #ddd;
            text-decoration: line-through;
            opacity: 0.6;
        }
        .check-box {
            width: 20px; height: 20px; border: 2px solid #000; background: #fff;
        }
        .check-row.done .check-box { background: #000; }

        /* SOP åŒºåŸŸ (ç›´æ¥å±•ç¤º) */
        .sop-box {
            border: var(--border-width) solid var(--border);
            box-shadow: var(--shadow);
            background: white;
            display: flex; flex-direction: column;
        }
        .sop-header {
            padding: 10px; background: #000; color: #fff; font-weight: bold; font-size: 14px;
            display: flex; justify-content: space-between;
        }
        .sop-content {
            flex: 1; padding: 15px; overflow-y: auto; 
            font-size: 14px; line-height: 1.6; white-space: pre-wrap;
        }
        .sop-textarea {
            flex: 1; padding: 15px; resize: none; border: none; outline: none; font-family: inherit; display: none;
        }

        /* --- å³ä¾§ä¸‹éƒ¨ï¼šä½¿ç”¨æ‰‹å†Œä¸æ¬è¿ --- */
        .manual-box {
            grid-column: 1 / -1; /* è·¨æ»¡æ•´è¡Œ */
            background: #fff;
            padding: 15px;
            overflow-y: auto;
            border: var(--border-width) solid var(--border);
            box-shadow: var(--shadow);
        }
        
        /* æŒ‰é’®æ ·å¼ */
        button {
            background: #fff; border: 2px solid #000; padding: 8px 16px; 
            font-weight: 900; cursor: pointer; box-shadow: 2px 2px 0 0 #000;
            transition: all 0.1s;
        }
        button:active { transform: translate(2px, 2px); box-shadow: 0 0 0 0 #000; }
        button.primary { background: #000; color: #fff; }

        /* è¾“å…¥æ¡† */
        .input-brutal {
            border: 2px solid #000; padding: 10px; outline: none; flex: 1; font-family: inherit;
        }

        /* æ‰‹æœºé€‚é… */
        @media (max-width: 768px) {
            main { grid-template-columns: 1fr; grid-template-rows: auto; display: flex; flex-direction: column; overflow-y: auto; }
            .sidebar { height: 200px; flex-shrink: 0; }
            .workspace { grid-template-columns: 1fr; display: flex; flex-direction: column; height: auto; }
            .subtasks-box, .sop-box { height: 300px; flex-shrink: 0; }
        }
    </style>
</head>
<body>

    <nav>
        <h1>TASK_COMMANDER</h1>
        <div style="font-weight:bold;">v8.0 NEO</div>
    </nav>

    <main>
        <section class="box sidebar">
            <div class="list-header">
                ä»»åŠ¡åˆ—è¡¨
                <button onclick="addTask()">ï¼‹ æ–°å»º</button>
            </div>
            <div id="list-container" style="flex:1; overflow-y:auto;"></div>
        </section>

        <div class="workspace">
            
            <div class="task-header-box">
                <input type="text" id="task-title" class="title-input" onchange="updateTask('title', this.value)">
                <div style="display:flex; align-items:center; gap:10px;">
                    <span id="progress-text" style="font-size:30px; font-weight:900; opacity:0.2;">0%</span>
                    <input type="time" id="task-time" onchange="updateTask('time', this.value)" style="border:2px solid #000; padding:5px;">
                </div>
            </div>

            <div class="subtasks-box">
                <div style="font-weight:bold; margin-bottom:10px; border-bottom:2px solid #000; padding-bottom:5px;">æ‰§è¡Œæ­¥éª¤</div>
                <div id="subtask-list" style="flex:1; overflow-y:auto;"></div>
                
                <div style="display:flex; gap:10px; margin-top:10px;">
                    <input type="text" id="new-sub-input" class="input-brutal" placeholder="è¾“å…¥ä¸‹ä¸€æ­¥...">
                    <button class="primary" onclick="addSubTask()">æ·»åŠ </button>
                </div>
            </div>

            <div class="sop-box">
                <div class="sop-header">
                    <span>SOP ä½œæˆ˜æ‰‹å†Œ</span>
                    <span onclick="toggleSopEdit()" style="cursor:pointer; text-decoration:underline;">[ç¼–è¾‘/ä¿å­˜]</span>
                </div>
                <div id="sop-view" class="sop-content"></div>
                <textarea id="sop-edit" class="sop-textarea" placeholder="åœ¨æ­¤è¾“å…¥ SOP æµç¨‹..."></textarea>
            </div>

        </div>

        <section class="manual-box">
            <div style="display:flex; gap:10px; border-bottom:2px solid #000; padding-bottom:10px; margin-bottom:10px;">
                <button onclick="showManual('manual')">ç³»ç»Ÿæ‰‹å†Œ</button>
                <button onclick="showManual('data')">æ•°æ®æ¬è¿(åŒæ­¥)</button>
            </div>
            
            <div id="manual-content">
                <strong>1. ç•Œé¢ä»‹ç»ï¼š</strong> å·¦ä¾§é€‰ä»»åŠ¡ï¼Œå³ä¾§ç›´æ¥æ“ä½œã€‚SOP åŒºåŸŸå¸¸é©»æ˜¾ç¤ºï¼Œæ–¹ä¾¿å¯¹ç…§æ‰§è¡Œã€‚<br>
                <strong>2. åˆ é™¤ä»»åŠ¡ï¼š</strong> ç‚¹å‡»ä»»åŠ¡åˆ—è¡¨å³ä¾§çš„ [åˆ ] æŒ‰é’®å³å¯ç§»é™¤ã€‚<br>
                <strong>3. è‡ªåŠ¨ä¿å­˜ï¼š</strong> æ‰€æœ‰æ“ä½œå³åˆ»å­˜å…¥æœ¬åœ°ï¼Œæ— éœ€æ‰‹åŠ¨ä¿å­˜ã€‚
            </div>

            <div id="data-content" style="display:none; flex-direction:column; gap:10px;">
                <p>å°†ä¸‹æ–¹ä»£ç å¤åˆ¶å‘ç»™æ‰‹æœºï¼Œæˆ–å°†æ‰‹æœºä»£ç ç²˜è´´è‡³æ­¤ã€‚</p>
                <textarea id="data-area" class="input-brutal" style="height:60px; font-size:10px;"></textarea>
                <div style="display:flex; gap:10px;">
                    <button onclick="copyData()">å¤åˆ¶æ•°æ® (å¯¼å‡º)</button>
                    <button class="primary" onclick="importData()">ç²˜è´´æ•°æ® (å¯¼å…¥)</button>
                </div>
            </div>
        </section>
    </main>

    <script>
        // --- æ•°æ®ç¡¬æ¤å…¥ (ç¡®ä¿ä½ çš„æ•°æ®ä¸ä¸¢) ---
        const HARD_DATA = [{"id":1769856578154,"title":"dankoeçš„åœ¨ä¸€å¤©å†…å½»åº•æ”¹å˜äººç”Ÿåˆ°åº•æœ‰å¤šå¼ºå¤§","subtasks":[],"reminderTime":"","sop":""},{"id":1769855581999,"title":"åšä¸€ä¸ªæ¯æ—¥æé†’dankoeå†™çš„é—®é¢˜æé†’","subtasks":[],"reminderTime":"","sop":""},{"id":1769850813071,"title":"æ¢æ¨ç‰¹å·ï¼Œå†™ä¸€ç¯‡å…³äºç…œå­æ˜¾åŒ–æ–‡ç« ","subtasks":[],"reminderTime":"","sop":""},{"id":1769786819936,"title":"å†™ä¸€ç¯‡å…¬ä¼—å·ç§è‰","subtasks":[{"text":"é€‰é¢˜","done":false},{"text":"é€‰é¢˜ï¼šä¸ºä»€ä¹ˆè¯´ï¼Œaiæ—¶ä»£æˆ‘ä»¬çš„ä¼˜åŠ¿æ›´å¤šäº†ï¼Ÿ","done":false}],"reminderTime":"08:00","sop":""},{"id":1769774974790,"title":"ç»ˆç‚¹ç³»ç»Ÿç½‘é¡µåˆ¶ä½œ","subtasks":[{"text":"å»ºç«‹å¤§çº²","done":true},{"text":"åšå®šè‡ªå·±çš„æƒ³æ³•...","done":true},{"text":"åˆ†äº«ç»™æœ‹å‹...","done":true},{"text":"å­¦ä¼šå¦‚ä½•åœ¨githubé‡Œé¢åšç½‘å€","done":true},{"text":"åŠ å…¥ä½¿ç”¨æ‰‹å†Œ","done":true}],"reminderTime":"08:09","sop":"# ğŸ–ï¸ å…¨èƒ½å¼€å‘è€…åè®® (v3.0)\n\n## é˜¶æ®µä¸€ï¼šå»ºç«‹å¤§çº²\n- ç¡¬æ€§è¦æ±‚ï¼šä¸¥ç¦ç›´æ¥è®© AI å¼€å·¥ã€‚\n..."}];

        let tasks = [];
        let currentId = null;

        window.onload = function() {
            const local = localStorage.getItem('cmd_v8_data');
            if(local && local.length > 20) {
                try { tasks = JSON.parse(local); } catch(e) { tasks = HARD_DATA; }
            } else {
                tasks = HARD_DATA;
            }
            if(tasks.length === 0) addTask(); 
            else selectTask(tasks[0].id);
        };

        function saveData() {
            localStorage.setItem('cmd_v8_data', JSON.stringify(tasks));
            document.getElementById('data-area').value = JSON.stringify(tasks);
        }

        function addTask() {
            const id = Date.now();
            tasks.unshift({ id: id, title: "æ–°ä»»åŠ¡ " + new Date().toLocaleTimeString().slice(0,5), subtasks: [], sop: "", reminderTime: "" });
            selectTask(id);
        }

        function deleteTask(e, id) {
            e.stopPropagation(); // é˜²æ­¢è§¦å‘é€‰æ‹©
            if(confirm("ç¡®è®¤åˆ é™¤æ­¤ä»»åŠ¡ï¼Ÿ")) {
                tasks = tasks.filter(t => t.id !== id);
                if(tasks.length === 0) addTask();
                else selectTask(tasks[0].id);
            }
        }

        function selectTask(id) {
            currentId = id;
            renderList();
            renderDetail();
        }

        function renderList() {
            const container = document.getElementById('list-container');
            container.innerHTML = tasks.map(t => {
                const total = t.subtasks ? t.subtasks.length : 0;
                const done = t.subtasks ? t.subtasks.filter(s => s.done).length : 0;
                const percent = total === 0 ? 0 : Math.round((done / total) * 100);
                
                return `
                <div class="task-item ${t.id === currentId ? 'active' : ''}" onclick="selectTask(${t.id})">
                    <div style="flex:1; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">
                        ${t.title}
                    </div>
                    <div style="font-size:12px; font-weight:bold;">${percent}%</div>
                    <button class="del-btn" onclick="deleteTask(event, ${t.id})">åˆ </button>
                </div>`;
            }).join('');
        }

        function renderDetail() {
            const t = tasks.find(x => x.id === currentId);
            if(!t) return;

            document.getElementById('task-title').value = t.title;
            document.getElementById('task-time').value = t.reminderTime || "";
            
            // æ¸²æŸ“SOP
            document.getElementById('sop-view').innerText = t.sop || "ï¼ˆç‚¹å‡»å³ä¸Šè§’ç¼–è¾‘ SOP å†…å®¹ï¼‰";
            document.getElementById('sop-edit').value = t.sop || "";

            // æ¸²æŸ“å­ä»»åŠ¡
            const subContainer = document.getElementById('subtask-list');
            subContainer.innerHTML = (t.subtasks || []).map((s, idx) => `
                <div class="check-row ${s.done ? 'done' : ''}" onclick="toggleSub(${idx})">
                    <div class="check-box"></div>
                    <span>${s.text}</span>
                </div>
            `).join('');

            // è¿›åº¦
            const total = t.subtasks ? t.subtasks.length : 0;
            const done = t.subtasks ? t.subtasks.filter(s => s.done).length : 0;
            const percent = total === 0 ? 0 : Math.round((done / total) * 100);
            document.getElementById('progress-text').innerText = percent + "%";
        }

        function updateTask(field, value) {
            const t = tasks.find(x => x.id === currentId);
            if(field === 'title') { t.title = value; renderList(); }
            if(field === 'time') t.reminderTime = value;
            saveData();
        }

        function addSubTask() {
            const input = document.getElementById('new-sub-input');
            if(!input.value) return;
            const t = tasks.find(x => x.id === currentId);
            if(!t.subtasks) t.subtasks = [];
            t.subtasks.push({ text: input.value, done: false });
            input.value = "";
            saveData(); renderDetail(); renderList();
        }

        function toggleSub(idx) {
            const t = tasks.find(x => x.id === currentId);
            t.subtasks[idx].done = !t.subtasks[idx].done;
            saveData(); renderDetail(); renderList();
        }

        function toggleSopEdit() {
            const view = document.getElementById('sop-view');
            const edit = document.getElementById('sop-edit');
            const t = tasks.find(x => x.id === currentId);
            
            if(edit.style.display === 'block') {
                // ä¿å­˜
                t.sop = edit.value;
                view.innerText = t.sop;
                edit.style.display = 'none'; view.style.display = 'block';
                saveData();
            } else {
                // ç¼–è¾‘
                edit.style.display = 'block'; view.style.display = 'none';
                edit.focus();
            }
        }

        function showManual(type) {
            document.getElementById('manual-content').style.display = type === 'manual' ? 'block' : 'none';
            document.getElementById('data-content').style.display = type === 'data' ? 'flex' : 'none';
            if(type === 'data') document.getElementById('data-area').value = JSON.stringify(tasks);
        }

        function copyData() {
            document.getElementById('data-area').select();
            document.execCommand('copy');
            alert("å·²å¤åˆ¶ï¼");
        }

        function importData() {
            try {
                const val = document.getElementById('data-area').value;
                if(!val) return;
                const newData = JSON.parse(val);
                if(confirm("å¯¼å…¥å°†è¦†ç›–å½“å‰æ•°æ®ï¼Œç¡®å®šå—ï¼Ÿ")) {
                    tasks = newData;
                    saveData(); renderList(); selectTask(tasks[0].id);
                    alert("å¯¼å…¥æˆåŠŸï¼");
                }
            } catch(e) { alert("æ•°æ®æ ¼å¼é”™è¯¯"); }
        }
    </script>
</body>
</html>
